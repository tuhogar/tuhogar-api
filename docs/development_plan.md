# Plano de Desenvolvimento

Este documento contém o plano detalhado para o desenvolvimento do sistema tuhogar-api. Cada tarefa inclui uma estimativa de tempo em horas e pode ser marcada como concluída quando finalizada.

## Legenda
- [ ] Tarefa pendente
- [x] Tarefa concluída

## 1. Desenvolvimento de diagrama de classes de todos os módulos do sistema

### 1.1. Módulo: Gerenciamento de Usuários

#### Registro de novos usuários
- [x] 1.1.1. Criar diagrama de caso de uso para Registro de novos usuários (2h)
- [x] 1.1.2. Criar diagrama de classes para Registro de novos usuários (3h)
- [x] 1.1.3. Criar diagrama de sequência para Registro de novos usuários (2.5h)

#### Autenticação de usuários (login)
- [x] 1.1.4. Criar diagrama de caso de uso para Autenticação de usuários (1.5h)
- [x] 1.1.5. Criar diagrama de classes para Autenticação de usuários (2.5h)
- [x] 1.1.6. Criar diagrama de sequência para Autenticação de usuários (2h)

#### Atualização de dados de usuários
- [x] 1.1.7. Criar diagrama de caso de uso para Atualização de dados de usuários (1.5h)
- [x] 1.1.8. Criar diagrama de classes para Atualização de dados de usuários (2h)
- [x] 1.1.9. Criar diagrama de sequência para Atualização de dados de usuários (2h)

#### Recuperação de senha
- [x] 1.1.10. Criar diagrama de caso de uso para Recuperação de senha (1.5h)
- [x] 1.1.11. Criar diagrama de classes para Recuperação de senha (2h)
- [x] 1.1.12. Criar diagrama de sequência para Recuperação de senha (2h)

#### Controle de níveis de acesso por perfis
- [x] 1.1.13. Criar diagrama de caso de uso para Controle de níveis de acesso (1.5h)
- [x] 1.1.14. Criar diagrama de classes para Controle de níveis de acesso (2h)
- [x] 1.1.15. Criar diagrama de sequência para Controle de níveis de acesso (1.5h)

#### Gerenciamento de usuários favoritos
- [x] 1.1.16. Criar diagrama de caso de uso para Gerenciamento de usuários favoritos (1.5h)
- [x] 1.1.17. Criar diagrama de classes para Gerenciamento de usuários favoritos (2h)
- [x] 1.1.18. Criar diagrama de sequência para Gerenciamento de usuários favoritos (2h)

#### Exclusão de usuários
- [x] 1.1.19. Criar diagrama de caso de uso para Exclusão de usuários (1h)
- [x] 1.1.20. Criar diagrama de classes para Exclusão de usuários (1.5h)
- [x] 1.1.21. Criar diagrama de sequência para Exclusão de usuários (1.5h)

#### Atualização de status de usuários
- [x] 1.1.22. Criar diagrama de caso de uso para Atualização de status de usuários (1h)
- [x] 1.1.23. Criar diagrama de classes para Atualização de status de usuários (1.5h)
- [x] 1.1.24. Criar diagrama de sequência para Atualização de status de usuários (1.5h)

### 1.2. Módulo: Gerenciamento de Contas

#### Criação de contas
- [x] 1.2.1. Criar diagrama de caso de uso para Criação de contas (1.5h)
- [x] 1.2.2. Criar diagrama de classes para Criação de contas (2.5h)
- [x] 1.2.3. Criar diagrama de sequência para Criação de contas (2h)

#### Atualização de informações da conta
- [x] 1.2.4. Criar diagrama de caso de uso para Atualização de informações da conta (1.5h)
- [x] 1.2.5. Criar diagrama de classes para Atualização de informações da conta (2h)
- [x] 1.2.6. Criar diagrama de sequência para Atualização de informações da conta (2h)

#### Consulta de dados da conta
- [x] 1.2.7. Criar diagrama de caso de uso para Consulta de dados da conta (1h)
- [x] 1.2.8. Criar diagrama de classes para Consulta de dados da conta (1.5h)
- [x] 1.2.9. Criar diagrama de sequência para Consulta de dados da conta (1.5h)

#### Processamento de imagens da conta
- [x] 1.2.10. Criar diagrama de caso de uso para Processamento de imagens da conta (1.5h)
- [x] 1.2.11. Criar diagrama de classes para Processamento de imagens da conta (2h)
- [x] 1.2.12. Criar diagrama de sequência para Processamento de imagens da conta (2h)

#### Exclusão de imagens da conta
- [x] 1.2.13. Criar diagrama de caso de uso para Exclusão de imagens da conta (1h)
- [x] 1.2.14. Criar diagrama de classes para Exclusão de imagens da conta (1.5h)
- [x] 1.2.15. Criar diagrama de sequência para Exclusão de imagens da conta (1.5h)

#### Atualização de status da conta
- [x] 1.2.16. Criar diagrama de caso de uso para Atualização de status da conta (1h)
- [x] 1.2.17. Criar diagrama de classes para Atualização de status da conta (1.5h)
- [x] 1.2.18. Criar diagrama de sequência para Atualização de status da conta (1.5h)

#### Exclusão de usuário da conta
- [x] 1.2.19. Criar diagrama de caso de uso para Exclusão de usuário da conta (1h)
- [x] 1.2.20. Criar diagrama de classes para Exclusão de usuário da conta (1.5h)
- [x] 1.2.21. Criar diagrama de sequência para Exclusão de usuário da conta (1.5h)

#### Busca de contas inativas
- [x] 1.2.22. Criar diagrama de caso de uso para Busca de contas inativas (1h)
- [x] 1.2.23. Criar diagrama de classes para Busca de contas inativas (1.5h)
- [x] 1.2.24. Criar diagrama de sequência para Busca de contas inativas (1.5h)

### 1.5. Módulo: Planos

#### Criação de planos
- [x] 1.5.1. Criar diagrama de caso de uso para Criação de planos (1.5h)
- [x] 1.5.2. Criar diagrama de classes para Criação de planos (2h)
- [x] 1.5.3. Criar diagrama de sequência para Criação de planos (2h)

#### Atualização de planos
- [x] 1.5.4. Criar diagrama de caso de uso para Atualização de planos (1.5h)
- [x] 1.5.5. Criar diagrama de classes para Atualização de planos (2h)
- [x] 1.5.6. Criar diagrama de sequência para Atualização de planos (2h)

#### Consulta de planos
- [x] 1.5.7. Criar diagrama de caso de uso para Consulta de planos (1h)
- [x] 1.5.8. Criar diagrama de classes para Consulta de planos (1.5h)
- [x] 1.5.9. Criar diagrama de sequência para Consulta de planos (1.5h)

#### Desativação de planos
- [x] 1.5.10. Criar diagrama de caso de uso para Desativação de planos (1h)
- [x] 1.5.11. Criar diagrama de classes para Desativação de planos (1.5h)
- [x] 1.5.12. Criar diagrama de sequência para Desativação de planos (1.5h)

### 1.6. Módulo: Eventos de Imóveis (Advertisement Events)

#### Registro de eventos de anúncios
- [x] 1.6.1. Criar diagrama de caso de uso para Registro de eventos de anúncios (1.5h)
- [x] 1.6.2. Criar diagrama de classes para Registro de eventos de anúncios (2h)
- [x] 1.6.3. Criar diagrama de sequência para Registro de eventos de anúncios (2h)

#### Geração de relatórios estatísticos mensais
- [x] 1.6.4. Criar diagrama de caso de uso para Geração de relatórios estatísticos mensais (1.5h)
- [x] 1.6.5. Criar diagrama de classes para Geração de relatórios estatísticos mensais (2h)
- [x] 1.6.6. Criar diagrama de sequência para Geração de relatórios estatísticos mensais (2h)

### 1.7. Módulo: Amenidades e Tipos de Contrato

#### Gerenciamento de amenidades
- [x] 1.7.1. Criar diagrama de caso de uso para Gerenciamento de amenidades (1.5h)
- [x] 1.7.2. Criar diagrama de classes para Gerenciamento de amenidades (2h)
- [x] 1.7.3. Criar diagrama de sequência para Gerenciamento de amenidades (2h)

#### Gerenciamento de tipos de contrato
- [x] 1.7.4. Criar diagrama de caso de uso para Gerenciamento de tipos de contrato (1.5h)
- [x] 1.7.5. Criar diagrama de classes para Gerenciamento de tipos de contrato (2h)
- [x] 1.7.6. Criar diagrama de sequência para Gerenciamento de tipos de contrato (2h)


## 2. Desenvolvimento da funcionalidade de geração de relatórios estatíticos mensais de imóveis

### 2.1. Domínio

#### Entidades de Domínio
- [x] 2.1.1. Criar entidade AccountAdvertisementStatistics (1.5h)
- [x] 2.1.2. Criar entidades de métricas (TotalAdvertisements, TotalVisits, PhoneClicks, etc.) (2h)
- [x] 2.1.3. Criar entidades para segmentação (TransactionTypeMetrics, PropertyTypeAndTransactionMetrics) (1.5h)
- [x] 2.1.4. Criar entidades para rankings (TopAdvertisements, AdvertisementMetric) (1h)
- [x] 2.1.5. Implementar validações de domínio (1h)

#### Interfaces de Repositório
- [x] 2.1.6. Definir interface IAccountAdvertisementStatisticsRepository (1h)
- [x] 2.1.7. Atualizar interfaces existentes (IAdvertisementEventRepository, IAdvertisementRepository, IAccountRepository) se necessário (1h)

### 2.2. Aplicação

#### Casos de Uso
- [x] 2.2.1. Implementar GenerateMonthlyStatisticsUseCase (3h)
- [x] 2.2.2. Implementar GetAccountStatisticsUseCase (2h)
- [x] 2.2.3. Implementar testes unitários para os casos de uso (2h)

#### Interfaces de Comando
- [x] 2.2.4. Criar interface GetAccountStatisticsUseCaseCommand para entrada do caso de uso (0.5h)
- [x] 2.2.5. Garantir que os casos de uso retornem entidades de domínio diretamente (0.5h)

### 2.3. Infraestrutura

#### Persistência
- [x] 2.3.1. Criar schema Mongoose para AccountAdvertisementStatistics (1.5h)
- [x] 2.3.2. Implementar MongooseAccountAdvertisementStatisticsRepository (2h)

#### Scheduler
- [x] 2.3.4. Implementar agendamento diretamente no caso de uso (1h)
- [x] 2.3.5. Configurar agendamento via variável de ambiente (1.5h)
- [x] 2.3.6. Implementar tratamento de erros para continuar processamento em caso de falha (1h)

#### Mappers
- [x] 2.3.7. Criar AccountAdvertisementStatisticsMapper para conversão entre entidade de domínio e modelo de persistência (1.5h)
- [x] 2.3.8. Implementar testes para os mappers (1h)

### 2.4. Interface

#### Controllers
- [x] 2.4.1. Implementar AdvertisementStatisticsController para consulta de estatísticas (1.5h)
- [x] 2.4.2. Implementar validação de entrada e autorização (1h)
- [x] 2.4.3. Implementar testes para os controllers (1h)
- [x] 2.4.4. Refatorar endpoints para ter um GET para listar todos os relatórios e um GET /:month para buscar relatório específico (1h)
- [x] 2.4.5. Adicionar permissão MASTER e parâmetro accountId ao endpoint de listagem de estatísticas (1h)
- [x] 2.4.6. Implementar validação do parâmetro accountId para usuários MASTER diretamente no controller (0.5h)

### 2.5. Configuração e Integração

#### Módulos
- [x] 2.5.1. Integrar com módulos existentes (http.module.ts e mongoose.module.ts) (1h)
- [x] 2.5.2. Registrar controllers, use-cases e repositórios nos módulos apropriados (0.5h)

#### Documentação de Configuração
- [x] 2.5.3. Atualizar documentação de configuração (0.5h)

### 2.6. Testes

#### Testes Unitários
- [x] 2.6.1. Implementar testes unitários para os casos de uso (2h)
- [x] 2.6.2. Implementar testes unitários para os controllers (1.5h)
- [x] 2.6.3. Implementar testes unitários para os mappers (1h)

### 2.7. Documentação

- [x] 2.7.1. Atualizar documentação técnica (1h)

### 2.8. Implementação de Cálculo Diferencial para Estatísticas Mensais

#### Análise e Planejamento
- [x] 2.8.1. Analisar o modelo atual de acumulação de eventos e identificar pontos de modificação (2h)
- [x] 2.8.2. Definir estratégia para armazenamento e recuperação de estatísticas do mês anterior (1h)
- [x] 2.8.3. Planejar modificações na interface do repositório, se necessário (1h)

#### Modificações no Caso de Uso
- [x] 2.8.4. Modificar GenerateMonthlyStatisticsUseCase para buscar estatísticas do mês anterior (2h)
- [x] 2.8.5. Implementar lógica para subtrair valores do mês anterior das estatísticas atuais (3h)
- [x] 2.8.6. Adicionar tratamento para o primeiro mês sem estatísticas anteriores (1h)
- [x] 2.8.7. Atualizar método calculateMetrics para considerar valores diferenciais (2h)

#### Modificações nos Testes
- [x] 2.8.8. Atualizar testes unitários do GenerateMonthlyStatisticsUseCase para cobrir cálculo diferencial (2h)
- [x] 2.8.9. Adicionar testes específicos para cenários de primeiro mês vs. meses subsequentes (1.5h)
- [x] 2.8.10. Implementar testes para verificar a precisão dos cálculos diferenciais (2h)

#### Documentação
- [x] 2.8.11. Atualizar documentação técnica para explicar o cálculo diferencial (1h)
- [x] 2.8.12. Adicionar comentários no código para explicar a lógica de cálculo diferencial (0.5h)

#### Integração e Validação
- [x] 2.8.13. Validar que a implementação não afeta endpoints existentes (1h)
- [x] 2.8.14. Verificar compatibilidade com dados históricos já armazenados (1.5h)

### 2.9. Correção do Cálculo Diferencial para totalAdvertisements

#### Análise e Planejamento
- [x] 2.9.1. Analisar o impacto da correção no cálculo diferencial (1h)
- [x] 2.9.2. Identificar todos os pontos onde totalAdvertisements é utilizado (0.5h)

#### Modificações no Caso de Uso
- [x] 2.9.3. Modificar o método calculateDifferentialMetricBase para excluir totalAdvertisements do cálculo diferencial (1h)
- [x] 2.9.4. Garantir que totalAdvertisements mantenha seus valores acumulativos originais (1h)

#### Modificações nos Testes
- [x] 2.9.5. Atualizar testes unitários para verificar que totalAdvertisements permanece acumulativo (1h)
- [x] 2.9.6. Adicionar testes específicos para validar o comportamento correto de totalAdvertisements (1h)

#### Documentação
- [x] 2.9.7. Atualizar documentação técnica para explicar o tratamento especial de totalAdvertisements (0.5h)
- [x] 2.9.8. Adicionar comentários no código para explicar a lógica específica para totalAdvertisements (0.5h)

## 3. Implementação da Limitação de Anúncios por Plano

### 3.1. Domínio

#### Entidades de Domínio
- [x] 3.1.1. Atualizar entidade Plan para incluir a propriedade maxAdvertisements (0.5h)
- [x] 3.1.2. Implementar validações de domínio para a nova propriedade (0.5h)

### 3.2. Infraestrutura

#### Persistência
- [x] 3.2.1. Atualizar schema Mongoose do Plan para incluir a propriedade maxAdvertisements (0.5h)
- [x] 3.2.2. Atualizar MongoosePlanMapper para incluir a nova propriedade (1h)
- [x] 3.2.3. Adicionar método countActiveOrWaitingByAccountId à interface IAdvertisementRepository (0.5h)
- [x] 3.2.4. Implementar o método countActiveOrWaitingByAccountId no MongooseAdvertisementRepository (1.5h)

### 3.3. Aplicação

#### Casos de Uso
- [x] 3.3.1. Atualizar UpdateFirebaseUsersDataUseCase para incluir maxAdvertisements nos claims do usuário (1h)
- [x] 3.3.2. Modificar CreateAdvertisementUseCase para validar o limite de anúncios (2h)
- [x] 3.3.3. Implementar lógica para verificar se o limite foi atingido antes de criar um novo anúncio (1.5h)

#### Testes
- [x] 3.3.4. Atualizar testes unitários para a entidade Plan (0.5h)
- [x] 3.3.5. Atualizar testes para o MongoosePlanMapper (0.5h)
- [x] 3.3.6. Implementar testes para o método countActiveOrWaitingByAccountId (1h)
- [x] 3.3.7. Atualizar testes para o UpdateFirebaseUsersDataUseCase (1h)
- [x] 3.3.8. Implementar testes para a validação de limite no CreateAdvertisementUseCase (1.5h)

### 3.4. Documentação

- [x] 3.4.1. Atualizar documentação técnica para explicar a limitação de anúncios por plano (1h)
- [x] 3.4.2. Documentar o processo de atualização manual da propriedade maxAdvertisements nos planos existentes (0.5h)

## 4. Implementação da Limitação de Fotos por Plano

### 4.1. Modelo de Dados

- [x] 4.1.1. Adicionar propriedade maxPhotos à entidade Plan (0.5h)
- [x] 4.1.2. Atualizar DTO e schema Mongoose para incluir maxPhotos (0.5h)

### 4.2. Infraestrutura

- [x] 4.2.1. Atualizar MongoosePlanMapper para mapear a propriedade maxPhotos (0.5h)
- [x] 4.2.2. Atualizar UpdateFirebaseUsersDataUseCase para incluir maxPhotos nos claims do usuário (0.5h)
- [x] 4.2.3. Atualizar AuthGuard para incluir maxPhotos no objeto AuthenticatedUser (0.5h)

### 4.3. Aplicação

#### Casos de Uso
- [x] 4.3.1. Modificar ProcessImagesAdvertisementUseCase para validar o limite de fotos (2h)
  - Buscar o plano da conta do anúncio (não do usuário autenticado)
  - Contar fotos existentes e verificar se novas fotos excederiam o limite
  - Implementar tratamento especial para usuários MASTER
  - Lançar erro apropriado quando o limite for excedido

#### Testes
- [x] 4.3.2. Atualizar testes para a entidade Plan com a propriedade maxPhotos (0.5h)
- [x] 4.3.3. Atualizar testes para o MongoosePlanMapper (0.5h)
- [x] 4.3.4. Implementar testes para a validação de limite no ProcessImagesAdvertisementUseCase (1.5h)

### 4.4. Documentação

- [x] 4.4.1. Atualizar documentação técnica para incluir a limitação de fotos por plano (1h)
- [x] 4.4.2. Atualizar o guia de administração para incluir a configuração de maxPhotos (0.5h)

## Resumo do Progresso do Projeto

```
Progresso Geral: 100% concluído (154/154 tarefas reais)
[####################]  
```

### Status por Sessão

- **1. Desenvolvimento de diagramas de classes**: 100% concluído ✓
- **2. Relatórios estatísticos mensais**: 100% concluído ✓
- **3. Limitação de anúncios por plano**: 100% concluído ✓
- **4. Limitação de fotos por plano**: 100% concluído ✓

*Atualizado em: 24/04/2025 21:52*
